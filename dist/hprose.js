// Hprose for WeChat App v2.0.0
// Copyright (c) 2008-2016 http://hprose.com
// Hprose is freely distributable under the MIT license.
// For all details and documentation:
// https://github.com/hprose/hprose-wx

function TimeoutError(e){Error.call(this),this.message=e,this.name=TimeoutError.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,TimeoutError)}var hprose=Object.create(null);Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var r=Array.prototype.slice.call(arguments,1),t=this,n=function(){},a=function(){return t.apply(this instanceof n?this:e,r.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(n.prototype=this.prototype),a.prototype=new n,a},function(e){function r(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return function(r){return e.apply(r,Array.prototype.slice.call(arguments,1))}}function t(e,t){for(var n=e.prototype,a=0,i=t.length;a<i;a++){var u=t[a],o=n[u];"function"==typeof o&&"undefined"==typeof e[u]&&Object.defineProperty(e,u,{value:r(o)})}}t(Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight","includes","find","findIndex"]),t(String,["quote","substring","toLowerCase","toUpperCase","charAt","charCodeAt","indexOf","lastIndexOf","include","startsWith","endsWith","repeat","trim","trimLeft","trimRight","toLocaleLowerCase","toLocaleUpperCase","match","search","replace","split","substr","concat","slice"]),e.parseuri=function(e){var r=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=e.match(r),n=t[4].split(":",2);return{protocol:t[1],host:t[4],hostname:n[0],port:parseInt(n[1],10)||0,path:t[5],query:t[7],fragment:t[9]}},e.isObjectEmpty=function(e){if(e){var r;for(r in e)return!1}return!0}}(hprose),TimeoutError.prototype=Object.create(Error.prototype),TimeoutError.prototype.constructor=TimeoutError,function(e){function r(e){var r=Array.prototype.slice.call(arguments,1);return function(){e.apply(void 0,r)}}function t(e){var r=i[e];if(r)try{r()}finally{delete i[e]}}function n(e){return i[a]=r.apply(void 0,e),a++}var a=1,i={};e.setImmediate=function(){return function(){var e=n(arguments);return setTimeout(r(t,e),0),e}}(),e.clearImmediate=function(e){delete i[e]}}(hprose),function(e,r){function t(e){var r=this;Object.defineProperties(r,{_subscribers:{value:[]},resolve:{value:this.resolve.bind(r)},reject:{value:this.reject.bind(r)}}),"function"==typeof e&&L(function(){try{r.resolve(e())}catch(e){r.reject(e)}})}function n(e){return e instanceof t}function a(e){return n(e)||e instanceof Promise&&typeof("function"===e.then)}function i(e){return n(e)?e:s(e)}function u(e,r){var n="function"==typeof r?r:function(){return r},a=new t;return setTimeout(function(){try{a.resolve(n())}catch(e){a.reject(e)}},e),a}function o(e){var r=new t;return r.reject(e),r}function s(e){var r=new t;return r.resolve(e),r}function c(e){try{var r=e();return s(r)}catch(e){return o(e)}}function f(e){var r=new t;return e(r.resolve,r.reject),r}function l(e){var r=0;return Array.forEach(e,function(){++r}),r}function h(e){return e=a(e)?e:s(e),e.then(function(e){var r=e.length,n=l(e),a=new Array(r);if(0===n)return s(a);var u=new t;return Array.forEach(e,function(e,r){i(e).then(function(e){a[r]=e,0===--n&&u.resolve(a)},u.reject)}),u})}function g(){return h(arguments)}function v(e){return e=a(e)?e:s(e),e.then(function(e){var r=new t;return Array.forEach(e,function(e){i(e).fill(r)}),r})}function d(e){return e=a(e)?e:s(e),e.then(function(e){var r=e.length,n=l(e);if(0===n)throw new RangeError("any(): array must not be empty");var a=new Array(r),u=new t;return Array.forEach(e,function(e,r){i(e).then(u.resolve,function(e){a[r]=e,0===--n&&u.reject(a)})}),u})}function p(e){return e=a(e)?e:s(e),e.then(function(e){var r=e.length,n=l(e),a=new Array(r);if(0===n)return s(a);var u=new t;return Array.forEach(e,function(e,r){var t=i(e);t.whenComplete(function(){a[r]=t.inspect(),0===--n&&u.resolve(a)})}),u})}function w(e){var t=Array.slice(arguments,1);return h(t).then(function(t){return e.apply(r,t)})}function T(e,r){var t=Array.slice(arguments,2);return h(t).then(function(t){return e.apply(r,t)})}function m(e,r){return function(){return h(arguments).then(function(t){return e.apply(r,t)})}}function b(e,r,t){return h(e).then(function(e){return e.forEach(r,t)})}function y(e,r,t){return h(e).then(function(e){return e.every(r,t)})}function C(e,r,t){return h(e).then(function(e){return e.some(r,t)})}function _(e,r,t){return h(e).then(function(e){return e.filter(r,t)})}function E(e,r,t){return h(e).then(function(e){return e.map(r,t)})}function O(e,r,t){return arguments.length>2?h(e).then(function(e){return a(t)||(t=s(t)),t.then(function(t){return e.reduce(r,t)})}):h(e).then(function(e){return e.reduce(r)})}function j(e,r,t){return arguments.length>2?h(e).then(function(e){return a(t)||(t=s(t)),t.then(function(t){return e.reduceRight(r,t)})}):h(e).then(function(e){return e.reduceRight(r)})}function A(e,r,t){return h(e).then(function(e){return a(r)||(r=s(r)),r.then(function(r){return e.indexOf(r,t)})})}function S(e,t,n){return h(e).then(function(e){return a(t)||(t=s(t)),t.then(function(t){return n===r&&(n=e.length-1),e.lastIndexOf(t,n)})})}function R(e,r,t){return h(e).then(function(e){return a(r)||(r=s(r)),r.then(function(r){return e.includes(r,t)})})}function k(e,r,t){return h(e).then(function(e){return e.find(r,t)})}function U(e,r,t){return h(e).then(function(e){return e.findIndex(r,t)})}function F(e,r,t){L(function(){try{var n=e(t);r.resolve(n)}catch(e){r.reject(e)}})}function I(e,r,t){e?F(e,r,t):r.resolve(t)}function M(e,r,t){e?F(e,r,t):r.reject(t)}function x(){var e=new t;Object.defineProperties(this,{future:{value:e},complete:{value:e.resolve},completeError:{value:e.reject},isCompleted:{get:function(){return e._state!==N}}})}var N=0,P=1,W=2,L=e.setImmediate;Object.defineProperties(t,{delayed:{value:u},error:{value:o},sync:{value:c},value:{value:s},all:{value:h},race:{value:v},resolve:{value:s},reject:{value:o},promise:{value:f},isFuture:{value:n},isPromise:{value:a},toPromise:{value:i},join:{value:g},any:{value:d},settle:{value:p},attempt:{value:w},run:{value:T},wrap:{value:m},forEach:{value:b},every:{value:y},some:{value:C},filter:{value:_},map:{value:E},reduce:{value:O},reduceRight:{value:j},indexOf:{value:A},lastIndexOf:{value:S},includes:{value:R},find:{value:k},findIndex:{value:U}}),Object.defineProperties(t.prototype,{_value:{writable:!0},_reason:{writable:!0},_state:{value:N,writable:!0},resolve:{value:function(e){if(e===this)return void this.reject(new TypeError("Self resolution"));if(n(e))return void e.fill(this);if(null!==e&&"object"==typeof e||"function"==typeof e){var r;try{r=e.then}catch(e){return void this.reject(e)}if("function"==typeof r){var t=!0;try{var a=this;return void r.call(e,function(e){t&&(t=!1,a.resolve(e))},function(e){t&&(t=!1,a.reject(e))})}catch(e){t&&(t=!1,this.reject(e))}return}}if(this._state===N){this._state=P,this._value=e;for(var i=this._subscribers;i.length>0;){var u=i.shift();I(u.onfulfill,u.next,e)}}}},reject:{value:function(e){if(this._state===N){this._state=W,this._reason=e;for(var r=this._subscribers;r.length>0;){var t=r.shift();M(t.onreject,t.next,e)}}}},then:{value:function(e,r){"function"!=typeof e&&(e=null),"function"!=typeof r&&(r=null);var n=new t;return this._state===P?I(e,n,this._value):this._state===W?M(r,n,this._reason):this._subscribers.push({onfulfill:e,onreject:r,next:n}),n}},done:{value:function(e,r){this.then(e,r).then(null,function(e){L(function(){throw e})})}},inspect:{value:function(){switch(this._state){case N:return{state:"pending"};case P:return{state:"fulfilled",value:this._value};case W:return{state:"rejected",reason:this._reason}}}},catchError:{value:function(e,r){if("function"==typeof r){var t=this;return this.catch(function(n){if(r(n))return t.catch(e);throw n})}return this.catch(e)}},catch:{value:function(e){return this.then(null,e)}},fail:{value:function(e){this.done(null,e)}},whenComplete:{value:function(e){return this.then(function(r){return e(),r},function(r){throw e(),r})}},complete:{value:function(e){return this.then(e,e)}},always:{value:function(e){this.done(e,e)}},fill:{value:function(e){this.then(e.resolve,e.reject)}},timeout:{value:function(e,r){var n=new t,a=setTimeout(function(){n.reject(r||new TimeoutError("timeout"))},e);return this.whenComplete(function(){clearTimeout(a)}).fill(n),n}},delay:{value:function(e){var r=new t;return this.then(function(t){setTimeout(function(){r.resolve(t)},e)},r.reject),r}},tap:{value:function(e,r){return this.then(function(t){return e.call(r,t),t})}},spread:{value:function(e,r){return this.then(function(t){return e.apply(r,t)})}},get:{value:function(e){return this.then(function(r){return r[e]})}},set:{value:function(e,r){return this.then(function(t){return t[e]=r,t})}},apply:{value:function(e,r){return r=r||[],this.then(function(t){return h(r).then(function(r){return t[e].apply(t,r)})})}},call:{value:function(e){var r=Array.slice(arguments,1);return this.then(function(t){return h(r).then(function(r){return t[e].apply(t,r)})})}},bind:{value:function(e){var r=Array.slice(arguments);{if(!Array.isArray(e)){r.shift();var t=this;return Object.defineProperty(this,e,{value:function(){var n=Array.slice(arguments);return t.then(function(t){return h(r.concat(n)).then(function(r){return t[e].apply(t,r)})})}}),this}for(var n=0,a=e.length;n<a;++n)r[0]=e[n],this.bind.apply(this,r)}}},forEach:{value:function(e,r){return b(this,e,r)}},every:{value:function(e,r){return y(this,e,r)}},some:{value:function(e,r){return C(this,e,r)}},filter:{value:function(e,r){return _(this,e,r)}},map:{value:function(e,r){return E(this,e,r)}},reduce:{value:function(e,r){return arguments.length>1?O(this,e,r):O(this,e)}},reduceRight:{value:function(e,r){return arguments.length>1?j(this,e,r):j(this,e)}},indexOf:{value:function(e,r){return A(this,e,r)}},lastIndexOf:{value:function(e,r){return S(this,e,r)}},includes:{value:function(e,r){return R(this,e,r)}},find:{value:function(e,r){return k(this,e,r)}},findIndex:{value:function(e,r){return U(this,e,r)}}}),e.Future=t,e.Completer=x,e.resolved=s,e.rejected=o,e.deferred=function(){var e=new t;return Object.create(null,{promise:{value:e},resolve:{value:e.resolve},reject:{value:e.reject}})}}(hprose),function(e,r){function t(e){return String.fromCharCode(e>>>24&255,e>>>16&255,e>>>8&255,255&e)}function n(e){return String.fromCharCode(255&e,e>>>8&255,e>>>16&255,e>>>24&255)}function a(e){for(var r=[],t=e.length,n=0,a=0;n<t;++n,++a){var i=e.charCodeAt(n);if(i<128)r[a]=e.charAt(n);else if(i<2048)r[a]=String.fromCharCode(192|i>>6,128|63&i);else{if(!(i<55296||i>57343)){if(n+1<t){var u=e.charCodeAt(n+1);if(i<56320&&56320<=u&&u<=57343){var o=((1023&i)<<10|1023&u)+65536;r[a]=String.fromCharCode(240|o>>18&63,128|o>>12&63,128|o>>6&63,128|63&o),++n;continue}}throw new Error("Malformed string")}r[a]=String.fromCharCode(224|i>>12,128|i>>6&63,128|63&i)}}return r.join("")}function i(e,r){for(var t=new Array(r),n=0,a=0,i=e.length;n<r&&a<i;n++){var u=e.charCodeAt(a++);switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t[n]=u;break;case 12:case 13:if(a<i){t[n]=(31&u)<<6|63&e.charCodeAt(a++);break}throw new Error("Unfinished UTF-8 octet sequence");case 14:if(a+1<i){t[n]=(15&u)<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++);break}throw new Error("Unfinished UTF-8 octet sequence");case 15:if(a+2<i){var o=((7&u)<<18|(63&e.charCodeAt(a++))<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++))-65536;if(0<=o&&o<=1048575){t[n++]=o>>10&1023|55296,t[n]=1023&o|56320;break}throw new Error("Character outside valid Unicode range: 0x"+o.toString(16))}throw new Error("Unfinished UTF-8 octet sequence");default:throw new Error("Bad UTF-8 encoding 0x"+u.toString(16))}}return n<r&&(t.length=n),[String.fromCharCode.apply(String,t),a]}function u(e,r){for(var t=[],n=new Array(32768),a=0,i=0,u=e.length;a<r&&i<u;a++){var o=e.charCodeAt(i++);switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n[a]=o;break;case 12:case 13:if(i<u){n[a]=(31&o)<<6|63&e.charCodeAt(i++);break}throw new Error("Unfinished UTF-8 octet sequence");case 14:if(i+1<u){n[a]=(15&o)<<12|(63&e.charCodeAt(i++))<<6|63&e.charCodeAt(i++);break}throw new Error("Unfinished UTF-8 octet sequence");case 15:if(i+2<u){var s=((7&o)<<18|(63&e.charCodeAt(i++))<<12|(63&e.charCodeAt(i++))<<6|63&e.charCodeAt(i++))-65536;if(0<=s&&s<=1048575){n[a++]=s>>10&1023|55296,n[a]=1023&s|56320;break}throw new Error("Character outside valid Unicode range: 0x"+s.toString(16))}throw new Error("Unfinished UTF-8 octet sequence");default:throw new Error("Bad UTF-8 encoding 0x"+o.toString(16))}if(a>=32766){var c=a+1;n.length=c,t[t.length]=String.fromCharCode.apply(String,n),r-=c,a=-1}}return a>0&&(n.length=a,t[t.length]=String.fromCharCode.apply(String,n)),[t.join(""),i]}function o(e,t){return(t===r||null===t||t<0)&&(t=e.length),0===t?["",0]:t<65535?i(e,t):u(e,t)}function s(e,t){if((t===r||null===t||t<0)&&(t=e.length),0===t)return"";for(var n=0,a=0,i=e.length;n<t&&a<i;n++){var u=e.charCodeAt(a++);switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(a<i){++a;break}throw new Error("Unfinished UTF-8 octet sequence");case 14:if(a+1<i){a+=2;break}throw new Error("Unfinished UTF-8 octet sequence");case 15:if(a+2<i){var o=((7&u)<<18|(63&e.charCodeAt(a++))<<12|(63&e.charCodeAt(a++))<<6|63&e.charCodeAt(a++))-65536;if(0<=o&&o<=1048575)break;throw new Error("Character outside valid Unicode range: 0x"+o.toString(16))}throw new Error("Unfinished UTF-8 octet sequence");default:throw new Error("Bad UTF-8 encoding 0x"+u.toString(16))}}return e.substr(0,a)}function c(e){return o(e)[0]}function f(e){for(var r=e.length,t=0,n=0;n<r;++n){var a=e.charCodeAt(n);if(a<128)++t;else if(a<2048)t+=2;else{if(!(a<55296||a>57343)){if(n+1<r){var i=e.charCodeAt(n+1);if(a<56320&&56320<=i&&i<=57343){++n,t+=4;continue}}throw new Error("Malformed string")}t+=3}}return t}function l(e){for(var r=e.length,t=0,n=0;n<r;++n,++t){var a=e.charCodeAt(n);switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(n<r){++n;break}throw new Error("Unfinished UTF-8 octet sequence");case 14:if(n+1<r){n+=2;break}throw new Error("Unfinished UTF-8 octet sequence");case 15:if(n+2<r){var i=((7&a)<<18|(63&e.charCodeAt(n++))<<12|(63&e.charCodeAt(n++))<<6|63&e.charCodeAt(n++))-65536;if(0<=i&&i<=1048575){++t;break}throw new Error("Character outside valid Unicode range: 0x"+i.toString(16))}throw new Error("Unfinished UTF-8 octet sequence");default:throw new Error("Bad UTF-8 encoding 0x"+a.toString(16))}}return t}function h(e){for(var r=0,t=e.length;r<t;++r){var n=e.charCodeAt(r);switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(r<t){++r;break}return!1;case 14:if(r+1<t){r+=2;break}return!1;case 15:if(r+2<t){var a=((7&n)<<18|(63&e.charCodeAt(r++))<<12|(63&e.charCodeAt(r++))<<6|63&e.charCodeAt(r++))-65536;if(0<=a&&a<=1048575)break}return!1;default:return!1}}return!0}function g(){var e=arguments;switch(e.length){case 1:this._buffer=[e[0].toString()];break;case 2:this._buffer=[e[0].toString().substr(e[1])];break;case 3:this._buffer=[e[0].toString().substr(e[1],e[2])];break;default:this._buffer=[""]}this.mark()}Object.defineProperties(g.prototype,{_buffer:{writable:!0},_off:{value:0,writable:!0},_wmark:{writable:!0},_rmark:{writable:!0},toString:{value:function(){return this._buffer.length>1&&(this._buffer=[this._buffer.join("")]),this._buffer[0]}},length:{get:function(){return this.toString().length}},position:{get:function(){return this._off}},mark:{value:function(){this._wmark=this.length,this._rmark=this._off}},reset:{value:function(){this._buffer=[this.toString().substr(0,this._wmark)],this._off=this._rmark}},clear:{value:function(){this._buffer=[""],this._wmark=0,this._off=0,this._rmark=0}},writeByte:{value:function(e){this._buffer.push(String.fromCharCode(255&e))}},writeInt32BE:{value:function(e){if(e===(0|e)&&e<=2147483647)return void this._buffer.push(t(e));throw new TypeError("value is out of bounds")}},writeUInt32BE:{value:function(e){if((2147483647&e)+2147483648===e&&e>=0)return void this._buffer.push(t(0|e));throw new TypeError("value is out of bounds")}},writeInt32LE:{value:function(e){if(e===(0|e)&&e<=2147483647)return void this._buffer.push(n(e));throw new TypeError("value is out of bounds")}},writeUInt32LE:{value:function(e){if((2147483647&e)+2147483648===e&&e>=0)return void this._buffer.push(n(0|e));throw new TypeError("value is out of bounds")}},writeUTF16AsUTF8:{value:function(e){this._buffer.push(a(e))}},writeUTF8AsUTF16:{value:function(e){this._buffer.push(c(e))}},write:{value:function(e){this._buffer.push(e)}},readByte:{value:function(){return this._off<this.length?this._buffer[0].charCodeAt(this._off++):-1}},readChar:{value:function(){return this._off<this.length?this._buffer[0].charAt(this._off++):""}},readInt32BE:{value:function(){var e=this.length,r=this._buffer[0],t=this._off;if(t+3<e){var n=r.charCodeAt(t++)<<24|r.charCodeAt(t++)<<16|r.charCodeAt(t++)<<8|r.charCodeAt(t++);return this._off=t,n}throw new Error("EOF")}},readUInt32BE:{value:function(){var e=this.readInt32BE();return e<0?(2147483647&e)+2147483648:e}},readInt32LE:{value:function(){var e=this.length,r=this._buffer[0],t=this._off;if(t+3<e){var n=r.charCodeAt(t++)|r.charCodeAt(t++)<<8|r.charCodeAt(t++)<<16|r.charCodeAt(t++)<<24;return this._off=t,n}throw new Error("EOF")}},readUInt32LE:{value:function(){var e=this.readInt32LE();return e<0?(2147483647&e)+2147483648:e}},read:{value:function(e){var r=this._off,t=this.length;return r+e>t&&(e=t-r),0===e?"":(this._off=r+e,this._buffer[0].substring(r,this._off))}},skip:{value:function(e){var r=this.length;return this._off+e>r?(e=r-this._off,this._off=r):this._off+=e,e}},readString:{value:function(e){var r=this.length,t=this._off,n=this._buffer[0],a=n.indexOf(e,t);return a===-1?(n=n.substr(t),this._off=r):(n=n.substring(t,a+1),this._off=a+1),n}},readUntil:{value:function(e){var r=this.length,t=this._off,n=this._buffer[0],a=n.indexOf(e,t);return a===this._off?(n="",this._off++):a===-1?(n=n.substr(t),this._off=r):(n=n.substring(t,a),this._off=a+1),n}},readUTF8:{value:function(e){var r=this.length,t=s(this._buffer[0].substring(this._off,Math.min(this._off+3*e,r)),e);return this._off+=t.length,t}},readUTF8AsUTF16:{value:function(e){var r=this.length,t=o(this._buffer[0].substring(this._off,Math.min(this._off+3*e,r)),e);return this._off+=t[1],t[0]}},readUTF16AsUTF8:{value:function(e){return a(this.read(e))}},take:{value:function(){var e=this.toString();return this.clear(),e}},clone:{value:function(){return new g(this.toString())}},trunc:{value:function(){var e=this.toString().substring(this._off,this._length);this._buffer[0]=e,this._off=0,this._wmark=0,this._rmark=0}}}),Object.defineProperties(g,{utf8Encode:{value:a},utf8Decode:{value:c},utf8Length:{value:f},utf16Length:{value:l},isUTF8:{value:h}}),e.StringIO=g}(hprose),hprose.Tags={TagInteger:"i",TagLong:"l",TagDouble:"d",TagNull:"n",TagEmpty:"e",TagTrue:"t",TagFalse:"f",TagNaN:"N",TagInfinity:"I",TagDate:"D",TagTime:"T",TagUTC:"Z",TagBytes:"b",TagUTF8Char:"u",TagString:"s",TagGuid:"g",TagList:"a",TagMap:"m",TagClass:"c",TagObject:"o",TagRef:"r",TagPos:"+",TagNeg:"-",TagSemicolon:";",TagOpenbrace:"{",TagClosebrace:"}",TagQuote:'"',TagPoint:".",TagFunctions:"F",TagCall:"C",TagResult:"R",TagArgument:"A",TagError:"E",TagEnd:"z"},function(e){function r(e,r){i.set(e,r),a[r]=e}function t(e){return i.get(e)}function n(e){return a[e]}var a=Object.create(null),i=new WeakMap;e.ClassManager=Object.create(null,{register:{value:r},getClassAlias:{value:t},getClass:{value:n}}),e.register=r,r(Object,"Object")}(hprose),function(e,r){function t(e){var r=e.constructor,t=C.getClassAlias(r);if(t)return t;if(r.name)t=r.name;else{var n=r.toString();if(t=n.substr(0,n.indexOf("(")).replace(/(^\s*function\s*)|(\s*$)/gi,""),""===t||"Object"===t)return"function"==typeof e.getClassName?e.getClassName():"Object"}return"Object"!==t&&C.register(r,t),t}function n(e){Object.defineProperties(this,{_stream:{value:e},_ref:{value:new Map,writable:!0}})}function a(e){return new n(e)}function i(e,r){Object.defineProperties(this,{stream:{value:e},_classref:{value:Object.create(null),writable:!0},_fieldsref:{value:[],writable:!0},_refer:{value:r?_:a(e)}})}function u(e,n){var a=e.stream;if(n===r||null===n||n.constructor===Function)return void a.write(y.TagNull);if(""===n)return void a.write(y.TagEmpty);switch(n.constructor){case Number:o(e,n);break;case Boolean:f(e,n);break;case String:1===n.length?(a.write(y.TagUTF8Char),a.write(n)):e.writeStringWithRef(n);break;case Date:e.writeDateWithRef(n);break;case Map:e.writeMapWithRef(n);break;default:if(Array.isArray(n))e.writeListWithRef(n);else{var i=t(n);"Object"===i?e.writeMapWithRef(n):e.writeObjectWithRef(n)}}}function o(e,r){var t=e.stream;r=r.valueOf(),r===(0|r)?0<=r&&r<=9?t.write(r):(t.write(y.TagInteger),t.write(r),t.write(y.TagSemicolon)):c(e,r)}function s(e,r){var t=e.stream;0<=r&&r<=9?t.write(r):(r<-2147483648||r>2147483647?t.write(y.TagLong):t.write(y.TagInteger),t.write(r),t.write(y.TagSemicolon))}function c(e,r){var t=e.stream;r!==r?t.write(y.TagNaN):r!==1/0&&r!==-(1/0)?(t.write(y.TagDouble),t.write(r),t.write(y.TagSemicolon)):(t.write(y.TagInfinity),t.write(r>0?y.TagPos:y.TagNeg))}function f(e,r){e.stream.write(r.valueOf()?y.TagTrue:y.TagFalse)}function l(e,r){e._refer.set(r);var t=e.stream;t.write(y.TagDate),t.write(("0000"+r.getUTCFullYear()).slice(-4)),t.write(("00"+(r.getUTCMonth()+1)).slice(-2)),t.write(("00"+r.getUTCDate()).slice(-2)),t.write(y.TagTime),t.write(("00"+r.getUTCHours()).slice(-2)),t.write(("00"+r.getUTCMinutes()).slice(-2)),t.write(("00"+r.getUTCSeconds()).slice(-2));var n=r.getUTCMilliseconds();0!==n&&(t.write(y.TagPoint),t.write(("000"+n).slice(-3))),t.write(y.TagUTC)}function h(e,r){e._refer.set(r);var t=e.stream,n=("0000"+r.getFullYear()).slice(-4),a=("00"+(r.getMonth()+1)).slice(-2),i=("00"+r.getDate()).slice(-2),u=("00"+r.getHours()).slice(-2),o=("00"+r.getMinutes()).slice(-2),s=("00"+r.getSeconds()).slice(-2),c=("000"+r.getMilliseconds()).slice(-3);"00"===u&&"00"===o&&"00"===s&&"000"===c?(t.write(y.TagDate),t.write(n),t.write(a),t.write(i)):"1970"===n&&"01"===a&&"01"===i?(t.write(y.TagTime),t.write(u),t.write(o),t.write(s),"000"!==c&&(t.write(y.TagPoint),t.write(c))):(t.write(y.TagDate),t.write(n),t.write(a),t.write(i),t.write(y.TagTime),t.write(u),t.write(o),t.write(s),"000"!==c&&(t.write(y.TagPoint),t.write(c))),t.write(y.TagSemicolon)}function g(e,r){e._refer.set(r);var t=e.stream,n=("00"+r.getHours()).slice(-2),a=("00"+r.getMinutes()).slice(-2),i=("00"+r.getSeconds()).slice(-2),u=("000"+r.getMilliseconds()).slice(-3);t.write(y.TagTime),t.write(n),t.write(a),t.write(i),"000"!==u&&(t.write(y.TagPoint),t.write(u)),t.write(y.TagSemicolon)}function v(e,r){e._refer.set(r);var t=e.stream,n=r.length;t.write(y.TagString),n>0?(t.write(n),t.write(y.TagQuote),t.write(r)):t.write(y.TagQuote),t.write(y.TagQuote)}function d(e,r){e._refer.set(r);var t=e.stream,n=r.length;if(t.write(y.TagList),n>0){t.write(n),t.write(y.TagOpenbrace);for(var a=0;a<n;a++)u(e,r[a])}else t.write(y.TagOpenbrace);t.write(y.TagClosebrace)}function p(e,r){e._refer.set(r);var t=e.stream,n=[];for(var a in r)r.hasOwnProperty(a)&&"function"!=typeof r[a]&&(n[n.length]=a);var i=n.length;if(t.write(y.TagMap),i>0){t.write(i),t.write(y.TagOpenbrace);for(var o=0;o<i;o++)u(e,n[o]),u(e,r[n[o]])}else t.write(y.TagOpenbrace);t.write(y.TagClosebrace)}function w(e,r){e._refer.set(r);var t=e.stream,n=r.size;t.write(y.TagMap),n>0?(t.write(n),t.write(y.TagOpenbrace),r.forEach(function(r,t){u(e,t),u(e,r)})):t.write(y.TagOpenbrace),t.write(y.TagClosebrace)}function T(e,r){var n,a,i=e.stream,o=t(r);if(o in e._classref)a=e._classref[o],n=e._fieldsref[a];else{n=[];for(var s in r)r.hasOwnProperty(s)&&"function"!=typeof r[s]&&(n[n.length]=s.toString());a=m(e,o,n)}i.write(y.TagObject),i.write(a),i.write(y.TagOpenbrace),e._refer.set(r);for(var c=n.length,f=0;f<c;f++)u(e,r[n[f]]);i.write(y.TagClosebrace)}function m(e,r,t){var n=e.stream,a=t.length;if(n.write(y.TagClass),n.write(r.length),n.write(y.TagQuote),n.write(r),n.write(y.TagQuote),a>0){n.write(a),n.write(y.TagOpenbrace);for(var i=0;i<a;i++)v(e,t[i])}else n.write(y.TagOpenbrace);n.write(y.TagClosebrace);var u=e._fieldsref.length;return e._classref[r]=u,e._fieldsref[u]=t,u}var b=e.StringIO,y=e.Tags,C=e.ClassManager,_=(b.utf8Encode,Object.create(null,{set:{value:function(){}},write:{value:function(){return!1}},reset:{value:function(){}}}));Object.defineProperties(n.prototype,{_refcount:{value:0,writable:!0},set:{value:function(e){this._ref.set(e,this._refcount++)}},write:{value:function(e){var t=this._ref.get(e);return t!==r&&(this._stream.write(y.TagRef),this._stream.write(t),this._stream.write(y.TagSemicolon),!0)}},reset:{value:function(){this._ref=new Map,this._refcount=0}}}),Object.defineProperties(i.prototype,{serialize:{value:function(e){u(this,e)}},writeInteger:{value:function(e){s(this,e)}},writeDouble:{value:function(e){c(this,e)}},writeBoolean:{value:function(e){f(this,e)}},writeUTCDate:{value:function(e){l(this,e)}},writeUTCDateWithRef:{value:function(e){this._refer.write(e)||l(this,e)}},writeDate:{value:function(e){h(this,e)}},writeDateWithRef:{value:function(e){this._refer.write(e)||h(this,e)}},writeTime:{value:function(e){g(this,e)}},writeTimeWithRef:{value:function(e){this._refer.write(e)||g(this,e)}},writeString:{value:function(e){v(this,e)}},writeStringWithRef:{value:function(e){this._refer.write(e)||v(this,e)}},writeList:{value:function(e){d(this,e)}},writeListWithRef:{value:function(e){this._refer.write(e)||d(this,e)}},writeMap:{value:function(e){e instanceof Map?w(this,e):p(this,e)}},writeMapWithRef:{value:function(e){this._refer.write(e)||this.writeMap(e)}},writeObject:{value:function(e){T(this,e)}},writeObjectWithRef:{value:function(e){this._refer.write(e)||T(this,e)}},reset:{value:function(){this._classref=Object.create(null),this._fieldsref.length=0,this._refer.reset()}}}),e.Writer=i}(hprose),function(e,r){function t(e,r){if(e&&r)throw new Error('Tag "'+r+'" expected, but "'+e+'" found in stream');if(e)throw new Error('Unexpected serialize tag "'+e+'" in stream');throw new Error("No byte found in stream")}function n(e){var r=new Z;return a(e,r),r.take()}function a(e,r){i(e,r,e.readChar())}function i(e,r,n){switch(r.write(n),n){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case $.TagNull:case $.TagEmpty:case $.TagTrue:case $.TagFalse:case $.TagNaN:break;case $.TagInfinity:r.write(e.read());break;case $.TagInteger:case $.TagLong:case $.TagDouble:case $.TagRef:u(e,r);break;case $.TagDate:case $.TagTime:o(e,r);break;case $.TagUTF8Char:s(e,r);break;case $.TagString:c(e,r);break;case $.TagGuid:f(e,r);break;case $.TagList:case $.TagMap:case $.TagObject:l(e,r);break;case $.TagClass:l(e,r),a(e,r);break;case $.TagError:a(e,r);break;default:t(n)}}function u(e,r){var t;do t=e.read(),r.write(t);while(t!==$.TagSemicolon)}function o(e,r){var t;do t=e.read(),r.write(t);while(t!==$.TagSemicolon&&t!==$.TagUTC)}function s(e,r){r.write(e.readChar())}function c(e,r){var t=e.readUntil($.TagQuote);r.write(t),r.write($.TagQuote);var n=0;t.length>0&&(n=parseInt(t,10)),r.write(e.read(n+1))}function f(e,r){r.write(e.read(38))}function l(e,r){var t;do t=e.readChar(),r.write(t);while(t!==$.TagOpenbrace);for(;(t=e.readChar())!==$.TagClosebrace;)i(e,r,t);r.write(t)}function h(e){Object.defineProperties(this,{stream:{value:e},readRaw:{value:function(){return n(e)}}})}function g(){Object.defineProperties(this,{ref:{value:[]}})}function v(){return new g}function d(e){var t,n=global,a=e.split(".");for(t=0;t<a.length;t++)if(n=n[a[t]],n===r)return null;return n}function p(e,r,t,n){if(t<r.length){var a=r[t];e[a]=n;var i=p(e,r,t+1,".");return t+1<r.length&&null===i&&(i=p(e,r,t+1,"_")),i}var u=e.join("");try{var o=d(u);return"function"==typeof o?o:null}catch(e){return null}}function w(e){var r=K.getClass(e);if(r)return r;if(r=d(e),"function"==typeof r)return K.register(r,e),r;for(var t=[],n=e.indexOf("_");n>=0;)t[t.length]=n,n=e.indexOf("_",n+1);if(t.length>0){var a=e.split("");if(r=p(a,t,0,"."),null===r&&(r=p(a,t,0,"_")),"function"==typeof r)return K.register(r,e),r}return r=function(){},Object.defineProperties(r.prototype,{getClassName:{value:function(){return e}}}),K.register(r,e),r}function T(e,r){var t=e.readUntil(r);return 0===t.length?0:parseInt(t,10)}function m(e){var r=e.stream,n=r.readChar();switch(n){case"0":return 0;case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;case $.TagInteger:return b(r);case $.TagLong:return C(r);case $.TagDouble:return E(r);case $.TagNull:return null;case $.TagEmpty:return"";case $.TagTrue:return!0;case $.TagFalse:return!1;case $.TagNaN:return NaN;case $.TagInfinity:return j(r);case $.TagDate:return S(e);case $.TagTime:return k(e);case $.TagUTF8Char:return F(e);case $.TagString:return M(e);case $.TagGuid:return N(e);case $.TagList:return W(e);case $.TagMap:return e.useHarmonyMap?z(e):D(e);case $.TagClass:return G(e),Q(e);case $.TagObject:return q(e);case $.TagRef:return J(e);case $.TagError:throw new Error(x(e));default:t(n)}}function b(e){return T(e,$.TagSemicolon)}function y(e){var r=e.readChar();switch(r){case"0":return 0;case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;case $.TagInteger:return b(e);default:t(r)}}function C(e){var r=e.readUntil($.TagSemicolon),t=parseInt(r,10);return t.toString()===r?t:r}function _(e){var r=e.readChar();switch(r){case"0":return 0;case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;case $.TagInteger:case $.TagLong:return C(e);default:t(r)}}function E(e){return parseFloat(e.readUntil($.TagSemicolon))}function O(e){var r=e.readChar();switch(r){case"0":return 0;case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;case $.TagInteger:case $.TagLong:case $.TagDouble:return E(e);case $.TagNaN:return NaN;case $.TagInfinity:return j(e);default:t(r)}}function j(e){return e.readChar()===$.TagNeg?-(1/0):1/0}function A(e){var r=e.readChar();switch(r){case $.TagTrue:return!0;case $.TagFalse:return!1;default:t(r)}}function S(e){var r,t=e.stream,n=parseInt(t.read(4),10),a=parseInt(t.read(2),10)-1,i=parseInt(t.read(2),10),u=t.readChar();if(u===$.TagTime){var o=parseInt(t.read(2),10),s=parseInt(t.read(2),10),c=parseInt(t.read(2),10),f=0;u=t.readChar(),u===$.TagPoint&&(f=parseInt(t.read(3),10),u=t.readChar(),u>="0"&&u<="9"&&(t.skip(2),u=t.readChar(),u>="0"&&u<="9"&&(t.skip(2),u=t.readChar()))),r=u===$.TagUTC?new Date(Date.UTC(n,a,i,o,s,c,f)):new Date(n,a,i,o,s,c,f)}else r=u===$.TagUTC?new Date(Date.UTC(n,a,i)):new Date(n,a,i);return e.refer.set(r),r}function R(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagDate:return S(e);case $.TagRef:return J(e);default:t(r)}}function k(e){var r,t=e.stream,n=parseInt(t.read(2),10),a=parseInt(t.read(2),10),i=parseInt(t.read(2),10),u=0,o=t.readChar();return o===$.TagPoint&&(u=parseInt(t.read(3),10),o=t.readChar(),o>="0"&&o<="9"&&(t.skip(2),o=t.readChar(),o>="0"&&o<="9"&&(t.skip(2),o=t.readChar()))),r=o===$.TagUTC?new Date(Date.UTC(1970,0,1,n,a,i,u)):new Date(1970,0,1,n,a,i,u),e.refer.set(r),r}function U(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagTime:return k(e);case $.TagRef:return J(e);default:t(r)}}function F(e){return e.stream.read(1)}function I(e){var r=e.stream,t=T(r,$.TagQuote),n=r.read(t);return r.skip(1),n}function M(e){var r=I(e);return e.refer.set(r),r}function x(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagEmpty:return"";
case $.TagUTF8Char:return F(e);case $.TagString:return M(e);case $.TagRef:return J(e);default:t(r)}}function N(e){var r=e.stream;r.skip(1);var t=r.read(36);return r.skip(1),e.refer.set(t),t}function P(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagGuid:return N(e);case $.TagRef:return J(e);default:t(r)}}function W(e){var r=e.stream,t=[];e.refer.set(t);for(var n=T(r,$.TagOpenbrace),a=0;a<n;a++)t[a]=m(e);return r.skip(1),t}function L(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagList:return W(e);case $.TagRef:return J(e);default:t(r)}}function D(e){var r=e.stream,t={};e.refer.set(t);for(var n=T(r,$.TagOpenbrace),a=0;a<n;a++){var i=m(e),u=m(e);t[i]=u}return r.skip(1),t}function H(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagMap:return D(e);case $.TagRef:return J(e);default:t(r)}}function z(e){var r=e.stream,t=new Map;e.refer.set(t);for(var n=T(r,$.TagOpenbrace),a=0;a<n;a++){var i=m(e),u=m(e);t.set(i,u)}return r.skip(1),t}function B(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagMap:return z(e);case $.TagRef:return J(e);default:t(r)}}function q(e){var r=e.stream,t=e.classref[T(r,$.TagOpenbrace)],n=new t.classname;e.refer.set(n);for(var a=0;a<t.count;a++)n[t.fields[a]]=m(e);return r.skip(1),n}function Q(e){var r=e.stream.readChar();switch(r){case $.TagNull:return null;case $.TagClass:return G(e),Q(e);case $.TagObject:return q(e);case $.TagRef:return J(e);default:t(r)}}function G(e){for(var r=e.stream,t=I(e),n=T(r,$.TagOpenbrace),a=[],i=0;i<n;i++)a[i]=x(e);r.skip(1),t=w(t),e.classref.push({classname:t,count:n,fields:a})}function J(e){return e.refer.read(T(e.stream,$.TagSemicolon))}function Y(e,r,t){h.call(this,e),this.useHarmonyMap=!!t,Object.defineProperties(this,{classref:{value:[]},refer:{value:r?V:v()}})}var Z=e.StringIO,$=e.Tags,K=e.ClassManager;e.RawReader=h;var V=Object.create(null,{set:{value:function(){}},read:{value:function(){t($.TagRef)}},reset:{value:function(){}}});Object.defineProperties(g.prototype,{set:{value:function(e){this.ref.push(e)}},read:{value:function(e){return this.ref[e]}},reset:{value:function(){this.ref.length=0}}}),Y.prototype=Object.create(h.prototype),Y.prototype.constructor=Y,Object.defineProperties(Y.prototype,{useHarmonyMap:{value:!1,writable:!0},checkTag:{value:function(e,n){n===r&&(n=this.stream.readChar()),n!==e&&t(n,e)}},checkTags:{value:function(e,n){return n===r&&(n=this.stream.readChar()),e.indexOf(n)>=0?n:void t(n,e)}},unserialize:{value:function(){return m(this)}},readInteger:{value:function(){return y(this.stream)}},readLong:{value:function(){return _(this.stream)}},readDouble:{value:function(){return O(this.stream)}},readBoolean:{value:function(){return A(this.stream)}},readDateWithoutTag:{value:function(){return S(this)}},readDate:{value:function(){return R(this)}},readTimeWithoutTag:{value:function(){return k(this)}},readTime:{value:function(){return U(this)}},readStringWithoutTag:{value:function(){return M(this)}},readString:{value:function(){return x(this)}},readGuidWithoutTag:{value:function(){return N(this)}},readGuid:{value:function(){return P(this)}},readListWithoutTag:{value:function(){return W(this)}},readList:{value:function(){return L(this)}},readMapWithoutTag:{value:function(){return this.useHarmonyMap?z(this):D(this)}},readMap:{value:function(){return this.useHarmonyMap?B(this):H(this)}},readObjectWithoutTag:{value:function(){return q(this)}},readObject:{value:function(){return Q(this)}},reset:{value:function(){this.classref.length=0,this.refer.reset()}}}),e.Reader=Y}(hprose),function(e){function r(e,r){var t=new n,i=new a(t,r);return i.serialize(e),t.take()}function t(e,r,t){return e instanceof n||(e=new n(e)),new i(e,r,t).unserialize()}var n=e.StringIO,a=e.Writer,i=e.Reader;e.Formatter=Object.create(null,{serialize:{value:r},unserialize:{value:t}}),e.serialize=r,e.unserialize=t}(hprose),hprose.ResultMode={Normal:0,Serialized:1,Raw:2,RawWithEndTag:3},hprose.Normal=hprose.ResultMode.Normal,hprose.Serialized=hprose.ResultMode.Serialized,hprose.Raw=hprose.ResultMode.Raw,hprose.RawWithEndTag=hprose.ResultMode.RawWithEndTag,function(e,r){function t(){}function n(e,n,a){function i(e,r){for(var t=0,n=Qe.length;t<n;t++)e=Qe[t].outputFilter(e,r);return e}function g(e,r){for(var t=Qe.length-1;t>=0;t--)e=Qe[t].inputFilter(e,r);return e}function y(e,r){return e=i(e,r),rr(e,r).then(function(e){if(!r.oneway)return g(e,r)})}function C(e,r){return ur.sendAndReceive(e,r).catchError(function(t){var n=O(e,r);if(null!==n)return n;throw t})}function _(e,r,t,n){er(e,r).then(t,n)}function E(){var e=Ie.length;if(e>1){var r=Me+1;r>=e&&(r=0,He++),Me=r,Fe=Ie[Me]}else He++;typeof ur.onfailswitch===m&&ur.onfailswitch(ur)}function O(e,r){if(r.failswitch&&E(),r.idempotent&&r.retried<r.retry){var t=500*++r.retried;return r.failswitch&&(t-=500*(Ie.length-1)),t>5e3&&(t=5e3),t>0?h.delayed(t,function(){return C(e,r)}):C(e,r)}return null}function j(e){var r={retry:We,retried:0,idempotent:!0,failswitch:!0,timeout:Pe,client:ur,userdata:{}},t=function(r){var t=null;try{var n=new c(r),a=new l(n,(!0)),i=n.readChar();switch(i){case o.TagError:t=new Error(a.readString());break;case o.TagFunctions:var u=a.readList();a.checkTag(o.TagEnd),R(e,u);break;default:t=new Error("Wrong Response:\r\n"+r)}}catch(e){t=e}null!==t?Ye.reject(t):Ye.resolve(e)};_(d,r,t,Ye.reject)}function A(e,r){return function(){return Ge?x(e,r,Array.slice(arguments),!0):h.all(arguments).then(function(t){return x(e,r,t,!1)})}}function S(e,t,n,a,i){if(t[a]===r&&(t[a]={},typeof i!==w&&i.constructor!==Object||(i=[i]),Array.isArray(i)))for(var u=0;u<i.length;u++){var o=i[u];if(typeof o===w)t[a][o]=A(e,n+a+"_"+o);else for(var s in o)S(e,t[a],a+"_",s,o[s])}}function R(e,t){for(var n=0;n<t.length;n++){var a=t[n];if(typeof a===w)e[a]===r&&(e[a]=A(e,a));else for(var i in a)S(e,e,"",i,a[i])}}function k(e,r){for(var t=Math.min(e.length,r.length),n=0;n<t;++n)r[n]=e[n]}function U(e){return e?{mode:s.Normal,byref:xe,simple:Ne,onsuccess:r,onerror:r,useHarmonyMap:qe,client:ur,userdata:{}}:{mode:s.Normal,byref:xe,simple:Ne,timeout:Pe,retry:We,retried:0,idempotent:Le,failswitch:De,oneway:!1,sync:!1,onsuccess:r,onerror:r,useHarmonyMap:qe,client:ur,userdata:{}}}function F(e,r,t,n){var a=U(n);if(r in e){var i=e[r];for(var u in i)u in a&&(a[u]=i[u])}for(var o=0,s=t.length;o<s&&typeof t[o]!==m;++o);if(o===s)return a;var c=t.splice(o,s-o);for(a.onsuccess=c[0],s=c.length,o=1;o<s;++o){var f=c[o];switch(typeof f){case m:a.onerror=f;break;case p:a.byref=f;break;case T:a.mode=f;break;case b:for(var l in f)l in a&&(a[l]=f[l])}}return a}function I(e,r,t){var n=new c;n.write(o.TagCall);var a=new f(n,t.simple);return a.writeString(e),(r.length>0||t.byref)&&(a.reset(),a.writeList(r),t.byref&&a.writeBoolean(!0)),n}function M(e,r,t,n){return ze?h.promise(function(a,i){Be.push({batch:n,name:e,args:r,context:t,resolve:a,reject:i})}):n?D(e,r,t):L(e,r,t)}function x(e,r,t,n){return M(r,t,F(e,r,t,n),n)}function N(e,r,t,n){try{t.onerror?t.onerror(e,r):ur.onerror&&ur.onerror(e,r),n(r)}catch(e){n(e)}}function P(e,r,t){var n=I(e,r,t);return n.write(o.TagEnd),h.promise(function(e,a){_(n.toString(),t,function(n){if(t.oneway)return void e();var i=null,u=null;try{if(t.mode===s.RawWithEndTag)i=n;else if(t.mode===s.Raw)i=n.substring(0,n.length-1);else{var f=new c(n),h=new l(f,(!1),t.useHarmonyMap),g=f.readChar();if(g===o.TagResult){if(i=t.mode===s.Serialized?h.readRaw():h.unserialize(),g=f.readChar(),g===o.TagArgument){h.reset();var v=h.readList();k(v,r),g=f.readChar()}}else g===o.TagError&&(u=new Error(h.readString()),g=f.readChar());g!==o.TagEnd&&(u=new Error("Wrong Response:\r\n"+n))}}catch(e){u=e}u?a(u):e(i)},a)})}function W(e){return function(){e&&(ze=!1,u(function(e){e.forEach(function(e){"settings"in e?q(e.settings).then(e.resolve,e.reject):M(e.name,e.args,e.context,e.batch).then(e.resolve,e.reject)})},Be),Be=[])}}function L(e,r,t){t.sync&&(ze=!0);var n=h.promise(function(n,a){Ve(e,r,t).then(function(i){try{if(t.onsuccess)try{t.onsuccess(i,r)}catch(r){t.onerror&&t.onerror(e,r),a(r)}n(i)}catch(e){a(e)}},function(r){N(e,r,t,a)})});return n.whenComplete(W(t.sync)),n}function D(e,r,t){return h.promise(function(n,a){Je.push({args:r,name:e,context:t,resolve:n,reject:a})})}function H(e){var r={timeout:Pe,retry:We,retried:0,idempotent:Le,failswitch:De,oneway:!1,sync:!1,client:ur,userdata:{}};for(var t in e)t in r&&(r[t]=e[t]);return r}function z(e,r){var t=e.reduce(function(e,r){return e.write(I(r.name,r.args,r.context)),e},new c);return t.write(o.TagEnd),h.promise(function(n,a){_(t.toString(),r,function(t){if(r.oneway)return void n(e);var i=-1,u=new c(t),f=new l(u,(!1),(!1)),h=u.readChar();try{for(;h!==o.TagEnd;){var g=null,v=null,d=e[++i].context.mode;if(d>=s.Raw&&(g=new c),h===o.TagResult){if(d===s.Serialized?g=f.readRaw():d>=s.Raw?(g.write(o.TagResult),g.write(f.readRaw())):(f.useHarmonyMap=e[i].context.useHarmonyMap,f.reset(),g=f.unserialize()),h=u.readChar(),h===o.TagArgument){if(d>=s.Raw)g.write(o.TagArgument),g.write(f.readRaw());else{f.reset();var p=f.readList();k(p,e[i].args)}h=u.readChar()}}else h===o.TagError&&(d>=s.Raw?(g.write(o.TagError),g.write(f.readRaw())):(f.reset(),v=new Error(f.readString())),h=u.readChar());if([o.TagEnd,o.TagResult,o.TagError].indexOf(h)<0)return void a(new Error("Wrong Response:\r\n"+t));d>=s.Raw?(d===s.RawWithEndTag&&g.write(o.TagEnd),e[i].result=g.toString()):e[i].result=g,e[i].error=v}}catch(e){return void a(e)}n(e)},a)})}function B(){Ge=!0}function q(e){if(e=e||{},Ge=!1,ze)return h.promise(function(r,t){Be.push({batch:!0,settings:e,resolve:r,reject:t})});var r=Je.length;if(0===r)return h.value([]);var t=H(e);t.sync&&(ze=!0);var n=Je;Je=[];var a=h.promise(function(e,r){Xe(n,t).then(function(r){r.forEach(function(e){if(e.error)N(e.name,e.error,e.context,e.reject);else try{if(e.context.onsuccess)try{e.context.onsuccess(e.result,e.args)}catch(r){e.context.onerror&&e.context.onerror(e.name,r),e.reject(r)}e.resolve(e.result)}catch(r){e.reject(r)}delete e.context,delete e.resolve,delete e.reject}),e(r)},function(e){n.forEach(function(r){"reject"in r&&N(r.name,e,r.context,r.reject)}),r(e)})});return a.whenComplete(W(t.sync)),a}function Q(){return Fe}function G(){return Ie}function J(e){if(typeof e===w)Ie=[e];else{if(!Array.isArray(e))return;Ie=e.slice(0),Ie.sort(function(){return Math.random()-.5})}Me=0,Fe=Ie[Me]}function Y(){return De}function Z(e){De=!!e}function $(){return He}function K(){return Pe}function V(e){Pe="number"==typeof e?0|e:0}function X(){return We}function ee(e){We="number"==typeof e?0|e:0}function re(){return Le}function te(e){Le=!!e}function ne(e){Ke=!!e}function ae(){return Ke}function ie(){return xe}function ue(e){xe=!!e}function oe(){return Ne}function se(e){Ne=!!e}function ce(){return qe}function fe(e){qe=!!e}function le(){return 0===Qe.length?null:1===Qe.length?Qe[0]:Qe.slice()}function he(e){Qe.length=0,Array.isArray(e)?e.forEach(function(e){ge(e)}):ge(e)}function ge(e){e&&"function"==typeof e.inputFilter&&"function"==typeof e.outputFilter&&Qe.push(e)}function ve(e){var r=Qe.indexOf(e);return r!==-1&&(Qe.splice(r,1),!0)}function de(){return Qe}function pe(e,t,n){n===r&&(typeof t===p&&(n=t,t=!1),t||(typeof e===p?(n=e,e=!1):(e&&e.constructor===Object||Array.isArray(e))&&(t=e,e=!1)));var a=ur;return n&&(a={}),e||Fe?(e&&(Fe=e),(typeof t===w||t&&t.constructor===Object)&&(t=[t]),Array.isArray(t)?(R(a,t),Ye.resolve(a),a):(u(j,a),Ye)):new Error("You should set server uri first!")}function we(e,r,n){var a=arguments.length;if(a<1||typeof e!==w)throw new Error("name must be a string");if(1===a&&(r=[]),2===a&&!Array.isArray(r)){var i=[];typeof r!==m&&i.push(t),i.push(r),r=i}if(a>2){typeof n!==m&&r.push(t);for(var u=2;u<a;u++)r.push(arguments[u])}return x(ur,e,r,Ge)}function Te(e,r){return Ye.then(e,r)}function me(e,r){if(Ze[e]){var t=Ze[e];if(t[r])return t[r]}return null}function be(e,t,n,a,i){if(typeof e!==w)throw new TypeError("topic name must be a string.");if(t===r||null===t){if(typeof n!==m)throw new TypeError("callback must be a function.");t=n}if(Ze[e]||(Ze[e]=Object.create(null)),typeof t===m)return a=n,n=t,void je().then(function(r){be(e,r,n,a,i)});if(typeof n!==m)throw new TypeError("callback must be a function.");if(h.isPromise(t))return void t.then(function(r){be(e,r,n,a,i)});a===r&&(a=Pe);var u=me(e,t);if(null===u){var o=function(){x(ur,e,[t,u.handler,o,{idempotent:!0,failswitch:i,timeout:a}],!1)};u={handler:function(r){var n=me(e,t);if(n){if(null!==r)for(var a=n.callbacks,i=0,u=a.length;i<u;++i)try{a[i](r)}catch(e){}null!==me(e,t)&&o()}},callbacks:[n]},Ze[e][t]=u,o()}else u.callbacks.indexOf(n)<0&&u.callbacks.push(n)}function ye(e,r,t){if(e)if(typeof t===m){var n=e[r];if(n){var a=n.callbacks,i=a.indexOf(t);i>=0&&(a[i]=a[a.length-1],a.length--),0===a.length&&delete e[r]}}else delete e[r]}function Ce(e,t,n){if(typeof e!==w)throw new TypeError("topic name must be a string.");if(t===r||null===t){if(typeof n!==m)return void delete Ze[e];t=n}if(typeof t===m&&(n=t,t=null),null===t)if(null===$e){if(Ze[e]){var a=Ze[e];for(t in a)ye(a,t,n)}}else $e.then(function(r){Ce(e,r,n)});else h.isPromise(t)?t.then(function(r){Ce(e,r,n)}):ye(Ze[e],t,n);v(Ze[e])&&delete Ze[e]}function _e(e){return!!Ze[e]}function Ee(){var e=[];for(var r in Ze)e.push(r);return e}function Oe(){return $e}function je(){return null===$e&&($e=x(ur,"#",[],!1)),$e}function Ae(e){tr.push(e),Ve=tr.reduceRight(function(e,r){return function(t,n,a){return h.sync(function(){return r(t,n,a,e)})}},P)}function Se(e){nr.push(e),Xe=nr.reduceRight(function(e,r){return function(t,n){return h.sync(function(){return r(t,n,e)})}},z)}function Re(e){ar.push(e),er=ar.reduceRight(function(e,r){return function(t,n){return h.sync(function(){return r(t,n,e)})}},y)}function ke(e){ir.push(e),rr=ir.reduceRight(function(e,r){return function(t,n){return h.sync(function(){return r(t,n,e)})}},C)}function Ue(e){return Ae(e),ur}var Fe,Ie=[],Me=-1,xe=!1,Ne=!1,Pe=3e4,We=10,Le=!1,De=!1,He=0,ze=!1,Be=[],qe=!1,Qe=[],Ge=!1,Je=[],Ye=new h,Ze=Object.create(null),$e=null,Ke=!0,Ve=P,Xe=z,er=y,rr=C,tr=[],nr=[],ar=[],ir=[],ur=this;je.sync=!0,je.idempotent=!0,je.failswitch=!0;var or=Object.create(null,{begin:{value:B},end:{value:q},use:{value:function(e){return Se(e),or}}}),sr=Object.create(null,{use:{value:function(e){return Re(e),sr}}}),cr=Object.create(null,{use:{value:function(e){return ke(e),cr}}});Object.defineProperties(this,{"#":{value:je},onerror:{value:null,writable:!0},onfailswitch:{value:null,writable:!0},uri:{get:Q},uriList:{get:G,set:J},id:{get:Oe},failswitch:{get:Y,set:Z},failround:{get:$},timeout:{get:K,set:V},retry:{get:X,set:ee},idempotent:{get:re,set:te},keepAlive:{get:ae,set:ne},byref:{get:ie,set:ue},simple:{get:oe,set:se},useHarmonyMap:{get:ce,set:fe},filter:{get:le,set:he},addFilter:{value:ge},removeFilter:{value:ve},filters:{get:de},useService:{value:pe},invoke:{value:we},ready:{value:Te},subscribe:{value:be},unsubscribe:{value:Ce},isSubscribed:{value:_e},subscribedList:{value:Ee},use:{value:Ue},batch:{value:or},beforeFilter:{value:sr},afterFilter:{value:cr}}),a&&typeof a===b&&["failswitch","timeout","retry","idempotent","keepAlive","byref","simple","useHarmonyMap","filter"].forEach(function(e){e in a&&ur[e](a[e])}),e&&(J(e),pe(n))}function a(e){var r=g(e),t=r.protocol;if("http:"!==t&&"https:"!==t)throw new Error("The "+t+" client isn't implemented.")}function i(r,t,n){try{return e.HttpClient.create(r,t,n)}catch(e){}if("string"==typeof r)a(r);else if(Array.isArray(r))throw r.forEach(function(e){a(e)}),new Error("Not support multiple protocol.");throw new Error("You should set server uri first!")}var u=e.setImmediate,o=e.Tags,s=e.ResultMode,c=e.StringIO,f=e.Writer,l=e.Reader,h=e.Future,g=e.parseuri,v=e.isObjectEmpty,d=o.TagEnd,p="boolean",w="string",T="number",m="function",b="object";Object.defineProperties(n,{create:{value:i}}),e.Client=n}(hprose),function(e){function r(e,t,n){function u(e,r){var t=new i,n={};for(var a in c)n[a]=c[a];return n["Content-Type"]="text/plain; charset=UTF-8",wx.request({url:f.uri,method:"POST",data:e,header:n,timeout:r.timeout,complete:function(e){200===e.statusCode?t.resolve(e.data):t.reject(new Error(e.statusCode+":"+e.data))}}),t}function o(e,r){var t=u(e,r);return r.oneway&&t.resolve(),t}function s(e,r){"content-type"!==e.toLowerCase()&&(r?c[e]=r:delete c[e])}if(this.constructor!==r)return new r(e,t,n);a.call(this,e,t,n);var c=Object.create(null),f=this;Object.defineProperties(this,{setHeader:{value:s},sendAndReceive:{value:o}})}function t(e){var r=u(e);if("http:"!==r.protocol&&"https:"!==r.protocol)throw new Error("This client desn't support "+r.protocol+" scheme.")}function n(e,n,a){if("string"==typeof e)t(e);else{if(!Array.isArray(e))throw new Error("You should set server uri first!");e.forEach(function(e){t(e)})}return new r(e,n,a)}var a=e.Client,i=e.Future,u=e.parseuri;Object.defineProperties(r,{create:{value:n}}),e.HttpClient=r}(hprose),function(e){function r(e){this.version=e||"2.0"}var t=e.Tags,n=e.StringIO,a=e.Writer,i=e.Reader,u=1;r.prototype.inputFilter=function(e){"{"===e.charAt(0)&&(e="["+e+"]");for(var r=JSON.parse(e),i=new n,u=new a(i,(!0)),o=0,s=r.length;o<s;++o){var c=r[o];c.error?(i.write(t.TagError),u.writeString(c.error.message)):(i.write(t.TagResult),u.serialize(c.result))}return i.write(t.TagEnd),i.take()},r.prototype.outputFilter=function(e){var r=[],a=new n(e),o=new i(a,(!1),(!1)),s=a.readChar();do{var c={};s===t.TagCall&&(c.method=o.readString(),s=a.readChar(),s===t.TagList&&(c.params=o.readListWithoutTag(),s=a.readChar()),s===t.TagTrue&&(s=a.readChar())),"1.1"===this.version?c.version="1.1":"2.0"===this.version&&(c.jsonrpc="2.0"),c.id=u++,r.push(c)}while(s===t.TagCall);return r.length>1?JSON.stringify(r):JSON.stringify(r[0])},e.JSONRPCClientFilter=r}(hprose),hprose.common={Completer:hprose.Completer,Future:hprose.Future,ResultMode:hprose.ResultMode},hprose.io={BytesIO:hprose.BytesIO,ClassManager:hprose.ClassManager,Tags:hprose.Tags,RawReader:hprose.RawReader,Reader:hprose.Reader,Writer:hprose.Writer,Formatter:hprose.Formatter},hprose.client={Client:hprose.Client,HttpClient:hprose.HttpClient,TcpClient:hprose.TcpClient,WebSocketClient:hprose.WebSocketClient},hprose.filter={JSONRPCClientFilter:hprose.JSONRPCClientFilter},module.exports=hprose;